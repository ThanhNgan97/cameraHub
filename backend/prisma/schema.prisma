generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model admin_logs {
  id          BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  admin_id    BigInt    @db.UnsignedBigInt
  action      String?   @db.VarChar(255)
  target_type String?   @db.VarChar(50)
  target_id   BigInt?   @db.UnsignedBigInt
  created_at  DateTime? @default(now()) @db.Timestamp(0)
  admins      admins    @relation(fields: [admin_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "admin_logs_ibfk_1")

  @@index([admin_id], map: "idx_admin_id")
  @@index([created_at], map: "idx_created_at")
}

model admin_permissions {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  admin_id   BigInt    @db.UnsignedBigInt
  permission String?   @db.VarChar(100)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  admins     admins    @relation(fields: [admin_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "admin_permissions_ibfk_1")

  @@index([admin_id], map: "idx_admin_id")
}

model admins {
  id                BigInt              @id @default(autoincrement()) @db.UnsignedBigInt
  full_name         String?             @db.VarChar(255)
  email             String              @unique(map: "email") @db.VarChar(255)
  password_hash     String              @db.Text
  role              admins_role?        @default(admin)
  is_active         Boolean?            @default(true)
  created_at        DateTime?           @default(now()) @db.Timestamp(0)
  admin_logs        admin_logs[]
  admin_permissions admin_permissions[]
  product_approvals product_approvals[]
  shop_approvals    shop_approvals[]

  @@index([email], map: "idx_email")
}

model brands {
  id         BigInt     @id @default(autoincrement()) @db.UnsignedBigInt
  name       String     @unique(map: "name") @db.VarChar(100)
  logo       String?    @db.Text
  created_at DateTime?  @default(now()) @db.Timestamp(0)
  products   products[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model cart_items {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  cart_id    BigInt    @db.UnsignedBigInt
  product_id BigInt    @db.UnsignedBigInt
  quantity   Int?
  created_at DateTime? @default(now()) @db.Timestamp(0)
  carts      carts     @relation(fields: [cart_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "cart_items_ibfk_1")
  products   products  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "cart_items_ibfk_2")

  @@index([cart_id], map: "idx_cart_id")
  @@index([product_id], map: "product_id")
}

model carts {
  id         BigInt       @id @default(autoincrement()) @db.UnsignedBigInt
  user_id    BigInt       @unique(map: "user_id") @db.UnsignedBigInt
  created_at DateTime?    @default(now()) @db.Timestamp(0)
  cart_items cart_items[]
  users      users        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "carts_ibfk_1")
}

model categories {
  id               BigInt       @id @default(autoincrement()) @db.UnsignedBigInt
  name             String       @unique(map: "name") @db.VarChar(100)
  parent_id        BigInt?      @db.UnsignedBigInt
  created_at       DateTime?    @default(now()) @db.Timestamp(0)
  categories       categories?  @relation("categoriesTocategories", fields: [parent_id], references: [id], onUpdate: NoAction, map: "categories_ibfk_1")
  other_categories categories[] @relation("categoriesTocategories")
  products         products[]

  @@index([parent_id], map: "idx_parent_id")
}

model notifications {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id    BigInt    @db.UnsignedBigInt
  title      String?   @db.VarChar(255)
  content    String?   @db.Text
  is_read    Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "notifications_ibfk_1")

  @@index([user_id], map: "idx_user_id")
}

model order_items {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  order_id   BigInt    @db.UnsignedBigInt
  product_id BigInt    @db.UnsignedBigInt
  price      Decimal?  @db.Decimal(12, 2)
  quantity   Int?
  created_at DateTime? @default(now()) @db.Timestamp(0)
  orders     orders    @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "order_items_ibfk_1")
  products   products  @relation(fields: [product_id], references: [id], onUpdate: NoAction, map: "order_items_ibfk_2")

  @@index([order_id], map: "idx_order_id")
  @@index([product_id], map: "product_id")
}

model orders {
  id             BigInt         @id @default(autoincrement()) @db.UnsignedBigInt
  user_id        BigInt         @db.UnsignedBigInt
  shop_id        BigInt         @db.UnsignedBigInt
  address_id     BigInt         @db.UnsignedBigInt
  total_price    Decimal?       @db.Decimal(12, 2)
  payment_method String?        @db.VarChar(50)
  status         orders_status? @default(pending)
  created_at     DateTime?      @default(now()) @db.Timestamp(0)
  updated_at     DateTime?      @default(now()) @db.Timestamp(0)
  order_items    order_items[]
  users          users          @relation(fields: [user_id], references: [id], onUpdate: NoAction, map: "orders_ibfk_1")
  shops          shops          @relation(fields: [shop_id], references: [id], onUpdate: NoAction, map: "orders_ibfk_2")
  user_addresses user_addresses @relation(fields: [address_id], references: [id], onUpdate: NoAction, map: "orders_ibfk_3")
  payments       payments[]
  system_orders  system_orders?

  @@index([address_id], map: "address_id")
  @@index([created_at], map: "idx_created_at")
  @@index([shop_id], map: "idx_shop_id")
  @@index([status], map: "idx_status")
  @@index([user_id], map: "idx_user_id")
}

model payments {
  id               BigInt           @id @default(autoincrement()) @db.UnsignedBigInt
  order_id         BigInt           @db.UnsignedBigInt
  payment_provider String?          @db.VarChar(50)
  transaction_id   String?          @db.VarChar(255)
  amount           Decimal?         @db.Decimal(12, 2)
  status           payments_status? @default(pending)
  created_at       DateTime?        @default(now()) @db.Timestamp(0)
  orders           orders           @relation(fields: [order_id], references: [id], onUpdate: NoAction, map: "payments_ibfk_1")

  @@index([order_id], map: "idx_order_id")
  @@index([transaction_id], map: "idx_transaction_id")
}

model product_approvals {
  id          BigInt                    @id @default(autoincrement()) @db.UnsignedBigInt
  product_id  BigInt                    @db.UnsignedBigInt
  admin_id    BigInt?                   @db.UnsignedBigInt
  status      product_approvals_status?
  note        String?                   @db.Text
  reviewed_at DateTime?                 @db.Timestamp(0)
  created_at  DateTime?                 @default(now()) @db.Timestamp(0)
  products    products                  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "product_approvals_ibfk_1")
  admins      admins?                   @relation(fields: [admin_id], references: [id], onUpdate: NoAction, map: "product_approvals_ibfk_2")

  @@index([admin_id], map: "admin_id")
  @@index([product_id], map: "idx_product_id")
}

model product_colors {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  product_id BigInt    @db.UnsignedBigInt
  color      String?   @db.VarChar(50)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  products   products  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "product_colors_ibfk_1")

  @@index([product_id], map: "idx_product_id")
}

model product_images {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  product_id BigInt    @db.UnsignedBigInt
  image_url  String    @db.Text
  is_main    Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  products   products  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "product_images_ibfk_1")

  @@index([product_id], map: "idx_product_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model products {
  id                BigInt              @id @default(autoincrement()) @db.UnsignedBigInt
  shop_id           BigInt              @db.UnsignedBigInt
  category_id       BigInt?             @db.UnsignedBigInt
  brand_id          BigInt?             @db.UnsignedBigInt
  name              String              @db.VarChar(255)
  brand             String?             @db.VarChar(100)
  category          String?             @db.VarChar(20)
  mount             String?             @db.VarChar(50)
  resolution        Int?
  price             Decimal             @db.Decimal(12, 2)
  discount_price    Decimal?            @db.Decimal(12, 2)
  stock             Int?                @default(0)
  condition         products_condition? @default(new)
  status            products_status?    @default(active)
  rating            Decimal?            @default(0.0) @db.Decimal(2, 1)
  reviews_count     Int?                @default(0)
  created_at        DateTime?           @default(now()) @db.Timestamp(0)
  updated_at        DateTime?           @default(now()) @db.Timestamp(0)
  cart_items        cart_items[]
  order_items       order_items[]
  product_approvals product_approvals[]
  product_colors    product_colors[]
  product_images    product_images[]
  shops             shops               @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "products_ibfk_1")
  categories        categories?         @relation(fields: [category_id], references: [id], onUpdate: NoAction, map: "products_ibfk_2")
  brands            brands?             @relation(fields: [brand_id], references: [id], onUpdate: NoAction, map: "products_ibfk_3")
  reviews           reviews[]
  wishlists         wishlists[]

  @@index([brand_id], map: "brand_id")
  @@index([category_id], map: "idx_category_id")
  @@index([price], map: "idx_price")
  @@index([shop_id], map: "idx_shop_id")
  @@index([status], map: "idx_status")
}

model reports {
  id          BigInt          @id @default(autoincrement()) @db.UnsignedBigInt
  reporter_id BigInt?         @db.UnsignedBigInt
  target_type String?         @db.VarChar(50)
  target_id   BigInt?         @db.UnsignedBigInt
  reason      String?         @db.Text
  status      reports_status? @default(pending)
  created_at  DateTime?       @default(now()) @db.Timestamp(0)
  users       users?          @relation(fields: [reporter_id], references: [id], onUpdate: NoAction, map: "reports_ibfk_1")

  @@index([status], map: "idx_status")
  @@index([target_type], map: "idx_target_type")
  @@index([reporter_id], map: "reporter_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model reviews {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id    BigInt    @db.UnsignedBigInt
  product_id BigInt    @db.UnsignedBigInt
  rating     Int?
  comment    String?   @db.Text
  created_at DateTime? @default(now()) @db.Timestamp(0)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "reviews_ibfk_1")
  products   products  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "reviews_ibfk_2")

  @@index([product_id], map: "idx_product_id")
  @@index([user_id], map: "idx_user_id")
}

model shop_approvals {
  id          BigInt                 @id @default(autoincrement()) @db.UnsignedBigInt
  shop_id     BigInt                 @db.UnsignedBigInt
  admin_id    BigInt?                @db.UnsignedBigInt
  status      shop_approvals_status?
  note        String?                @db.Text
  reviewed_at DateTime?              @db.Timestamp(0)
  created_at  DateTime?              @default(now()) @db.Timestamp(0)
  shops       shops                  @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "shop_approvals_ibfk_1")
  admins      admins?                @relation(fields: [admin_id], references: [id], onUpdate: NoAction, map: "shop_approvals_ibfk_2")

  @@index([admin_id], map: "admin_id")
  @@index([shop_id], map: "idx_shop_id")
}

model shop_discounts {
  id             BigInt                        @id @default(autoincrement()) @db.UnsignedBigInt
  shop_id        BigInt                        @db.UnsignedBigInt
  code           String?                       @db.VarChar(50)
  discount_type  shop_discounts_discount_type?
  discount_value Decimal?                      @db.Decimal(10, 2)
  start_date     DateTime?                     @db.Timestamp(0)
  end_date       DateTime?                     @db.Timestamp(0)
  is_active      Boolean?                      @default(true)
  created_at     DateTime?                     @default(now()) @db.Timestamp(0)
  shops          shops                         @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "shop_discounts_ibfk_1")

  @@index([code], map: "idx_code")
  @@index([shop_id], map: "idx_shop_id")
}

model shop_notifications {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  shop_id    BigInt    @db.UnsignedBigInt
  title      String?   @db.VarChar(255)
  content    String?   @db.Text
  is_read    Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  shops      shops     @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "shop_notifications_ibfk_1")

  @@index([shop_id], map: "idx_shop_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model shop_reviews {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  shop_id    BigInt    @db.UnsignedBigInt
  user_id    BigInt    @db.UnsignedBigInt
  rating     Int?
  comment    String?   @db.Text
  created_at DateTime? @default(now()) @db.Timestamp(0)
  shops      shops     @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "shop_reviews_ibfk_1")
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "shop_reviews_ibfk_2")

  @@index([shop_id], map: "idx_shop_id")
  @@index([user_id], map: "user_id")
}

model shop_statistics {
  shop_id        BigInt    @id @db.UnsignedBigInt
  total_orders   Int?      @default(0)
  total_revenue  Decimal?  @default(0.00) @db.Decimal(14, 2)
  total_products Int?      @default(0)
  updated_at     DateTime? @default(now()) @db.Timestamp(0)
  shops          shops     @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "shop_statistics_ibfk_1")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model shops {
  id                 BigInt               @id @default(autoincrement()) @db.UnsignedBigInt
  owner_id           BigInt               @db.UnsignedBigInt
  shop_name          String               @db.VarChar(255)
  description        String?              @db.Text
  logo               String?              @db.Text
  address            String?              @db.Text
  rating             Decimal?             @default(0.0) @db.Decimal(2, 1)
  total_products     Int?                 @default(0)
  status             shops_status?        @default(pending)
  created_at         DateTime?            @default(now()) @db.Timestamp(0)
  updated_at         DateTime?            @default(now()) @db.Timestamp(0)
  orders             orders[]
  products           products[]
  shop_approvals     shop_approvals[]
  shop_discounts     shop_discounts[]
  shop_notifications shop_notifications[]
  shop_reviews       shop_reviews[]
  shop_statistics    shop_statistics?
  users              users                @relation(fields: [owner_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "shops_ibfk_1")

  @@index([owner_id], map: "idx_owner_id")
  @@index([status], map: "idx_status")
}

model system_discounts {
  id             BigInt                          @id @default(autoincrement()) @db.UnsignedBigInt
  code           String?                         @db.VarChar(50)
  discount_type  system_discounts_discount_type?
  discount_value Decimal?                        @db.Decimal(10, 2)
  start_date     DateTime?                       @db.Timestamp(0)
  end_date       DateTime?                       @db.Timestamp(0)
  is_active      Boolean?                        @default(true)
  created_at     DateTime?                       @default(now()) @db.Timestamp(0)

  @@index([code], map: "idx_code")
  @@index([is_active], map: "idx_is_active")
}

model system_notifications {
  id         BigInt                       @id @default(autoincrement()) @db.UnsignedBigInt
  title      String?                      @db.VarChar(255)
  content    String?                      @db.Text
  target     system_notifications_target?
  created_at DateTime?                    @default(now()) @db.Timestamp(0)

  @@index([target], map: "idx_target")
}

model system_orders {
  order_id   BigInt    @id @db.UnsignedBigInt
  flagged    Boolean?  @default(false)
  note       String?   @db.Text
  created_at DateTime? @default(now()) @db.Timestamp(0)
  orders     orders    @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "system_orders_ibfk_1")
}

model system_settings {
  key        String    @id @db.VarChar(100)
  value      String?   @db.Text
  updated_at DateTime? @default(now()) @db.Timestamp(0)
}

model user_addresses {
  id             BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id        BigInt    @db.UnsignedBigInt
  full_name      String    @db.VarChar(255)
  phone          String    @db.VarChar(20)
  email          String?   @db.VarChar(255)
  province       String    @db.VarChar(100)
  district       String    @db.VarChar(100)
  ward           String    @db.VarChar(100)
  address_detail String    @db.Text
  note           String?   @db.Text
  is_default     Boolean?  @default(false)
  created_at     DateTime? @default(now()) @db.Timestamp(0)
  orders         orders[]
  users          users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_addresses_ibfk_1")

  @@index([user_id], map: "idx_user_id")
}

model user_coupons {
  id          BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id     BigInt    @db.UnsignedBigInt
  coupon_code String?   @db.VarChar(50)
  is_used     Boolean?  @default(false)
  created_at  DateTime? @default(now()) @db.Timestamp(0)
  users       users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_coupons_ibfk_1")

  @@index([user_id], map: "idx_user_id")
}

model users {
  id                     BigInt            @id @default(autoincrement()) @db.UnsignedBigInt
  full_name              String            @db.VarChar(255)
  email                  String            @unique(map: "email") @db.VarChar(255)
  phone                  String?           @unique(map: "phone") @db.VarChar(20)
  password_hash          String            @db.Text
  avatar                 String?           @db.Text
  provider               String?           @default("local") @db.VarChar(50)
  provider_id            String?           @db.VarChar(255)
  role                   users_role?       @default(user)
  status                 users_status?     @default(active)
  created_at             DateTime?         @default(now()) @db.Timestamp(0)
  updated_at             DateTime?         @default(now()) @db.Timestamp(0)
  reset_password_expires DateTime?         @db.Timestamp(0)
  reset_password_token   String?           @db.VarChar(255)
  carts                  carts?
  notifications          notifications[]
  orders                 orders[]
  password_resets        password_resets[]
  reports                reports[]
  reviews                reviews[]
  shop_reviews           shop_reviews[]
  shops                  shops[]
  user_addresses         user_addresses[]
  user_coupons           user_coupons[]
  wishlists              wishlists[]

  @@index([email], map: "idx_email")
  @@index([phone], map: "idx_phone")
  @@index([role], map: "idx_role")
  @@index([provider], map: "idx_provider")
  @@index([provider_id], map: "idx_provider_id")
}

model wishlists {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id    BigInt    @db.UnsignedBigInt
  product_id BigInt    @db.UnsignedBigInt
  created_at DateTime? @default(now()) @db.Timestamp(0)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "wishlists_ibfk_1")
  products   products  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "wishlists_ibfk_2")

  @@unique([user_id, product_id], map: "unique_wishlist")
  @@index([user_id], map: "idx_user_id")
  @@index([product_id], map: "product_id")
}

model password_resets {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id    BigInt    @db.UnsignedBigInt
  token      String    @unique(map: "token") @db.VarChar(255)
  expires_at DateTime  @db.DateTime(0)
  used_at    DateTime? @db.DateTime(0)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "password_resets_ibfk_1")

  @@index([user_id], map: "idx_user_id")
}

enum system_discounts_discount_type {
  percent
  fixed
}

enum product_approvals_status {
  approved
  rejected
}

enum shop_approvals_status {
  approved
  rejected
}

enum shop_discounts_discount_type {
  percent
  fixed
}

enum system_notifications_target {
  all
  users
  shops
}

enum admins_role {
  super_admin
  admin
  moderator
}

enum payments_status {
  pending
  completed
  failed
  refunded
}

enum reports_status {
  pending
  resolved
}

enum orders_status {
  pending
  paid
  shipped
  completed
  cancelled
}

enum users_role {
  user
  shop
  admin
}

enum users_status {
  active
  inactive
  banned
}

enum shops_status {
  pending
  approved
  rejected
  banned
}

enum products_condition {
  new
  used
  refurbished
}

enum products_status {
  active
  inactive
  pending
}
